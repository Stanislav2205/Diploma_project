# Backend-приложение для автоматизации закупок

Сервис реализует REST API для автоматизации закупок в розничной сети в рамках дипломного проекта Нетологии «Python-разработчик: расширенный курс». Функциональность охватывает работу с каталогом товаров, импорт прайсов поставщиков, корзину покупателя, оформление заказов и уведомления по email.

## Быстрый старт

```Bash
git clone https://github.com/Stanislav2205/Diploma_project.git
cd diploma_project
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
cp .env.example .env  # обновите значения переменных
python manage.py migrate
python manage.py runserver
```

### Переменные окружения

| Переменная | Описание |
| --- | --- |
| `DJANGO_SECRET_KEY` | Секретный ключ Django |
| `DJANGO_DEBUG` | Режим отладки (`1`/`0`) |
| `DJANGO_ALLOWED_HOSTS` | Допустимые хосты (`127.0.0.1 localhost`) |
| `DJANGO_DB_*` | Настройки подключения к базе (по умолчанию SQLite) |
| `DJANGO_DEFAULT_FROM_EMAIL` | Email отправителя |
| `DJANGO_ORDER_NOTIFICATION_EMAIL` | Email администратора для уведомлений |

При разработке используется консольный email-бекенд. Для боевого режима настройте SMTP через `DJANGO_EMAIL_BACKEND` и связанные переменные.

## Основные возможности API

- **Аутентификация и регистрация**: регистрация по email с подтверждением, JWT-токены, получение текущего профиля.
- **Каталог**: фильтрация и поиск по товарам, получение расширенной информации по каждой позиции.
- **Корзина**: добавление, изменение и удаление товаров, проверка остатков.
- **Контакты**: управление адресами доставки.
- **Заказы**: подтверждение корзины, уведомления клиента и администратора, просмотр историй заказов.
- **Поставщики**:
  - управление профилем магазина и статусом приёма заказов;
  - импорт прайса из YAML по URL/файлу/сырому JSON;
  - просмотр заказов, включающих товары конкретного магазина.

Документация OpenAPI доступна по адресу `http://127.0.0.1:8000/api/docs/`.

## Импорт прайса

Для импорта используйте POST-запрос к `POST /api/partner/import/` с авторизацией поставщика. Тело запроса может содержать:

- `url` — ссылка на YAML-файл (например, [пример из Нетологии](https://raw.githubusercontent.com/netology-code/python-final-diplom/master/data/shop1.yaml));
- `file` — загруженный YAML-файл;
- `data` — JSON-объект, аналогичный структуре `shop1.yaml`.

При успешной загрузке сервис очищает старые записи магазина и создаёт новые товары, характеристики и остатки.

## Типовой сценарий покупателя

1. Зарегистрироваться и подтвердить email.
2. Получить JWT-токен (`/api/auth/token/`).
3. Просмотреть каталог (`/api/products/`).
4. Добавить товары в корзину (`/api/cart/`).
5. Создать контакт/адрес (`/api/contacts/`).
6. Подтвердить заказ (`/api/orders/confirm/`) и получить уведомление.
7. Следить за статусами (`/api/orders/`).

## Тестирование

Проект включает полный набор автоматических тестов с покрытием кода 100%:

```bash
# Запуск всех тестов
python manage.py test

# Запуск с подробным выводом
python manage.py test --verbosity=2

# Проверка покрытия кода (требует установки coverage)
pip install coverage
coverage run --source=backend manage.py test
coverage report -m
```

В проекте реализовано **25 тестов**, покрывающих:
- Импорт каталога товаров (создание, обновление, валидация)
- Полный цикл работы покупателя (регистрация → корзина → заказ)
- API endpoints для всех ролей (покупатель, поставщик, администратор)
- Валидацию сериализаторов и моделей
- Обработку ошибок и граничных случаев

## Администрирование

Для доступа к административной панели Django создайте суперпользователя:

```bash
python manage.py createsuperuser
```

После этого административная панель будет доступна по адресу `http://127.0.0.1:8000/admin/`.

## Дополнительно

- Подключён `drf-spectacular` для генерации OpenAPI-схемы и интерактивной документации.
- Предусмотрено уведомление администратора и клиента при оформлении заказа (по умолчанию письма выводятся в консоль).
- Архитектура разделяет бизнес-логику (импорт каталога, отправка email) в модуле `backend/services/`.
- Полное покрытие тестами (100%) обеспечивает надёжность и стабильность работы API.

## Ресурсы для ориентира

- [Описание API](https://raw.githubusercontent.com/netology-code/python-final-diplom/master/reference/screens.md)
- [Пример YAML-прайса](https://raw.githubusercontent.com/netology-code/python-final-diplom/master/data/shop1.yaml)


